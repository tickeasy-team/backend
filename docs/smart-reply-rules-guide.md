# 🤖 智能回覆規則編寫指南

## 📋 目錄

- [基本概念](#基本概念)
- [關鍵字設計原則](#關鍵字設計原則)
- [規則優先級策略](#規則優先級策略)
- [實戰編寫範例](#實戰編寫範例)
- [測試與優化](#測試與優化)
- [常見陷阱](#常見陷阱)
- [快速開始](#快速開始)

## 🎯 基本概念

智能回覆系統採用**分層匹配策略**：

1. **圖文教學** (最高優先級) - 完整流程教學
2. **常見問答** (中等優先級) - 快速文字回答
3. **知識庫搜尋** (補充功能) - 動態內容搜尋
4. **中性回答** (最後手段) - 提供客服聯絡方式

## 🎨 關鍵字設計原則

### ✅ 最佳實踐

#### 1. **涵蓋同義詞和變體**

```typescript
// ❌ 不好的範例 - 太窄
keywords: ["購票"];

// ✅ 好的範例 - 涵蓋變體
keywords: [
  "購票",
  "買票",
  "下單",
  "訂票", // 核心動詞
  "購買門票",
  "買門票", // 完整詞組
  "如何購票",
  "怎麼買票", // 問句形式
  "購票流程",
  "買票步驟", // 流程相關
  "要怎麼買",
  "哪裡買票", // 口語化表達
];
```

#### 2. **考慮用戶真實語言**

```typescript
// 用戶可能的問法：
"我想買票但不知道怎麼買";
"可以線上購票嗎？";
"門票要去哪裡買？";
"第一次買票，步驟是什麼？";

// 對應關鍵字設計：
keywords: [
  "想買票",
  "不知道怎麼買",
  "線上購票",
  "門票",
  "哪裡買",
  "第一次買票",
  "步驟",
];
```

#### 3. **包含問句模式**

```typescript
keywords: [
  // 疑問詞
  "如何",
  "怎麼",
  "要怎麼",
  "怎樣",
  // 可能性詢問
  "可以嗎",
  "能嗎",
  "行嗎",
  "沒問題嗎",
  // 地點詢問
  "在哪",
  "哪裡",
  "什麼地方",
];
```

### ❌ 應該避免

#### 1. **過於寬泛的詞彙**

```typescript
// ❌ 會造成誤匹配
keywords: ["票", "買", "怎麼", "可以", "有"];

// ✅ 具體且明確
keywords: ["門票購買", "買票流程", "購票方式"];
```

#### 2. **語助詞和代名詞**

```typescript
// ❌ 避免使用
["的", "了", "嗎", "呢", "吧", "我", "你", "他"][
  // ✅ 使用實意詞
  ("購票", "退票", "付款", "座位", "會員")
];
```

## 🏆 規則優先級策略

### Priority 1 - 🔥 核心業務功能

最重要的業務流程，需要詳細圖文教學

```typescript
{
  priority: 1,
  examples: ['購票', '退票', '改票', '付款']
}
```

### Priority 2 - 📋 重要輔助功能

重要但不是核心的功能

```typescript
{
  priority: 2,
  examples: ['會員註冊', '密碼重設', '座位選擇', '發票']
}
```

### Priority 3 - 💡 一般支援功能

一般性問題和支援資訊

```typescript
{
  priority: 3,
  examples: ['客服時間', '聯絡方式', '活動取消', '技術問題']
}
```

## 💡 實戰編寫範例

### 圖文教學規則範例

```typescript
{
  keywords: [
    // 主要動詞
    '購票', '買票', '下單', '訂票',
    // 完整短語
    '購買門票', '買門票', '如何購票', '怎麼買票',
    // 流程相關
    '購票流程', '買票步驟', '訂票流程',
    // 問句形式
    '要怎麼買', '哪裡買票', '如何訂購',
    // 情境描述
    '想買演唱會票', '第一次購票', '不會買票'
  ],
  title: '完整購票教學',
  url: '/help/tutorial/how-to-buy-tickets',
  priority: 1,
  description: '從選擇活動到完成付款的完整圖文教學'
}
```

### FAQ 規則範例

```typescript
{
  keywords: [
    // 直接詢問
    '付款方式', '支付方法', '怎麼付錢',
    // 具體工具
    '信用卡', '轉帳', '超商', 'ATM',
    // 行動支付
    'Apple Pay', 'Google Pay', 'Line Pay',
    // 問句形式
    '可以刷卡嗎', '支援什麼付款', '有哪些付費方式'
  ],
  answer: `我們支援多種便利的付款方式：

💳 **信用卡支付**
• Visa、MasterCard、JCB
• 支援分期付款（3期、6期、12期）

🏦 **銀行轉帳**
• ATM 轉帳
• 網路銀行轉帳

付款完成後，您將立即收到確認郵件和電子票券。`,
  priority: 1,
  faqId: 'payment-methods'
}
```

## 🧪 測試與優化

### 1. 使用測試工具

```bash
# 執行規則測試
npm run test:smart-reply

# 或直接執行測試檔案
node scripts/test-smart-reply-rules.ts
```

### 2. 測試用例設計

```typescript
const TEST_CASES = [
  // 正面測試 - 應該匹配
  { input: "我要買票", expected: "tutorial", type: "購票教學" },
  { input: "怎麼退票？", expected: "tutorial", type: "退票教學" },

  // 變體測試 - 測試關鍵字覆蓋
  { input: "想購買門票", expected: "tutorial", type: "購票教學" },
  { input: "可以申請退款嗎", expected: "tutorial", type: "退票教學" },

  // 負面測試 - 不應該匹配
  { input: "今天天氣如何？", expected: "neutral", type: "無關問題" },
  { input: "你好嗎？", expected: "neutral", type: "閒聊" },
];
```

### 3. 性能監控

- 回應時間應 < 100ms
- 匹配準確率應 > 85%
- 關鍵字覆蓋率監控

## ⚠️ 常見陷阱

### 1. **關鍵字衝突**

```typescript
// ❌ 問題：關鍵字重疊造成錯誤匹配
Rule1: keywords: ["票", "購買"]; // 太寬泛
Rule2: keywords: ["電子票", "購買"]; // 會被 Rule1 誤匹配

// ✅ 解決：使用更具體的關鍵字
Rule1: keywords: ["門票購買", "現場取票"];
Rule2: keywords: ["電子票券", "電子票下載"];
```

### 2. **優先級設定錯誤**

```typescript
// ❌ 問題：重要功能優先級太低
{
  keywords: ['購票', '買票'],
  priority: 3  // 購票是核心功能，不應該是優先級 3
}

// ✅ 正確：核心功能給予最高優先級
{
  keywords: ['購票', '買票'],
  priority: 1  // 核心業務功能
}
```

### 3. **關鍵字不足**

```typescript
// ❌ 關鍵字太少，覆蓋不全
keywords: ["購票"];

// ✅ 充分覆蓋用戶可能的表達方式
keywords: [
  "購票",
  "買票",
  "下單",
  "訂票",
  "如何購票",
  "怎麼買票",
  "購票流程",
  "想買票",
  "要買門票",
  "線上購票",
];
```

## 🚀 快速開始

### 1. 編輯規則配置

```typescript
// 編輯檔案：config/smart-reply-rules.ts
export const TUTORIAL_RULES: TutorialRule[] = [
  {
    keywords: ["你的關鍵字陣列"],
    title: "教學標題",
    url: "/help/tutorial/your-tutorial",
    priority: 1,
    description: "教學描述",
  },
];
```

### 2. 測試規則效果

```bash
# 執行測試工具
node scripts/test-smart-reply-rules.ts
```

### 3. 部署上線

```bash
# 重啟服務讓新規則生效
npm run restart
```

## 📊 規則維護

### 定期檢查項目

- [ ] 關鍵字匹配準確率
- [ ] 用戶常見問題覆蓋度
- [ ] 系統回應時間
- [ ] 規則衝突檢查

### 優化策略

1. **數據驅動**: 根據用戶實際問題調整關鍵字
2. **A/B 測試**: 測試不同關鍵字組合的效果
3. **定期更新**: 根據新功能和政策更新規則
4. **用戶反饋**: 收集用戶對回覆滿意度的反饋

---

## 📞 需要協助？

如果在規則編寫過程中遇到問題：

- 📧 技術支援：tech-support@tickeasy.com
- 📚 查看更多範例：`config/smart-reply-rules.ts`
- 🧪 執行測試工具：`scripts/test-smart-reply-rules.ts`
